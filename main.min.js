const State={chosenIndices:new Set,guessesRemaining:0,gameEnded:false,currentGame:{},showingPlay:false,currentMakeGame:{},currentGameId:"",dailyGameId:""};const WORDS_PER_ROW=3;const WORDS_PER_COL=5;const WORDS_PER_GAME=WORDS_PER_ROW*WORDS_PER_COL;function serializeGameV0(e){const{wordListId:t,wordListIndices:a,answerIndices:n,hint:o}=e;const s=Base64.fromNumber(0);const r=Base64.fromNumber(t,2);const i=a.map(e=>Base64.fromNumber(e,2)).join("");const l=Base64.fromNumber(n.length);const c=n.map(e=>Base64.fromNumber(e)).join("");return rot13(s+r+i+l+c+o)}function serializeGameV1(e){const t=Base64.fromNumber(1);const{seed:a,hint:n}=e;return rot13(t+a+n)}async function generateRandomGame(e){const t=e||generateRandomBase64String(6);const a=new Math.seedrandom(t);const n=2;const o=generateUniqueRandomNumbers(WORDS_PER_GAME,await getWordListSize(n),a);const s=await getWords(n,o);const r=generateUniqueRandomNumbers(getRandomInt(2,5,a),15,a).sort();return{seed:t,wordListId:n,wordListIndices:o,words:s,answerIndices:r}}function loadNewGame(e){State.gameEnded=false;State.chosenIndices.clear();State.currentGame=e;State.currentGameId=e.id;const{hint:t,words:a,answerIndices:n}=State.currentGame;set("play-hint",`${t},${n.length}`);if(isDaily(State.currentGameId)){State.currentGame.dailyNumber=getDailyGameNumber();set("daily-number","#"+getDailyGameNumber())}range(WORDS_PER_GAME).forEach(e=>{const t=$(e);t.innerText=a[e];shade(t,Colors.NOT_CHOSEN)});if(isHardMode()){State.guessesRemaining=e.answerIndices.length;set("guesses",`<b>${State.guessesRemaining}</b> guesses`);show("guesses")}hide("next-game");hide("cant-wait");hide("cant-wait-q");hide("play-submit");hide("play-share");set("more","☰");showScreen("play")}function createBoard(e,t,a,n,o){const s=$(e);s.style.setProperty("--grid-rows",t);s.style.setProperty("--grid-cols",a);const r=n||(e=>e);const i=o||toggle;range(t*a).forEach(e=>{const t=document.createElement("div");t.id=r(e);t.addEventListener("click",()=>{i(t)});s.appendChild(t).className="grid-item"})}function toggle(e){if(State.gameEnded){return}if(isHardMode()){const t=Number(e.id);if(State.currentGame.answerIndices.includes(t)){shadeWithBorder(e,Colors.CORRECT)}else{shadeWithBorder(e,Colors.CHOSEN)}State.chosenIndices.add(t);State.guessesRemaining--;set("guesses",`<b>${State.guessesRemaining}</b> guesses`);if(State.guessesRemaining===0){hide("guesses");submit()}return}const t=Number(e.id);if(State.chosenIndices.has(t)){State.chosenIndices.delete(t);shade(e,Colors.NOT_CHOSEN)}else{State.chosenIndices.add(t);shadeWithBorder(e,Colors.CHOSEN)}if(State.chosenIndices.size===State.currentGame.answerIndices.length){show("play-submit")}else{hide("play-submit")}}function saveGame(e){e.timestamp=Date.now();const t=localStorage.getObj("games");t[e.id]=e;localStorage.setObj("games",t)}async function animateBoard(){for(const e of range(WORDS_PER_GAME)){const t=$(e);shade(t,Colors.CORRECT);await sleep(30)}for(const e of range(WORDS_PER_GAME)){const t=$(e);shade(t,Colors.CHOSEN);await sleep(30)}for(const e of range(WORDS_PER_GAME)){const t=$(e);shade(t,Colors.NOT_CHOSEN);await sleep(30)}await repeat(3,async()=>{range(WORDS_PER_GAME).forEach(e=>{const t=$(e);if(e%2===0){shade(t,Colors.CORRECT)}else{shade(t,Colors.NOT_CHOSEN)}});await sleep(200);range(WORDS_PER_GAME).forEach(e=>{const t=$(e);if(e%2===1){shade(t,Colors.CHOSEN)}else{shade(t,Colors.NOT_CHOSEN)}});await sleep(200)});range(WORDS_PER_GAME).forEach(e=>{const t=$(e);shade(t,Colors.NOT_CHOSEN)});await sleep(200)}async function submit(){State.gameEnded=true;let t=true;const o=Array.from(State.chosenIndices);State.currentGame.answerIndices.forEach(e=>{if(!State.chosenIndices.has(e)){t=false}});if(t){await animateBoard()}if(!isHardMode()){range(WORDS_PER_GAME).forEach(e=>{const t=$(e);const a=o.includes(e);const n=State.currentGame.answerIndices.includes(e);if(a&&n){shadeWithBorder(t,Colors.CORRECT)}else if(n){shade(t,Colors.CORRECT)}else if(a){shadeWithBorder(t,Colors.CHOSEN)}})}State.currentGame.chosenIndices=o.sort();State.currentGame.won=t;saveGame(State.currentGame);hide("play-submit");show("play-share");showNextGame()}function showNextGame(){const e=`<span class="pointer" onclick="goTo('https://awkword.co')"><b>play the daily awkword</b></span>`;if(isDaily(State.currentGameId)){timer("next-game","daily awkword in",e,()=>window.location.reload());show("cant-wait");show("cant-wait-q")}else{const t=localStorage.getObj("games");if(t[State.dailyGameId]){show("cant-wait")}else{set("next-game",e)}}show("next-game")}function forget(){const e=localStorage.getObj("games");delete e[State.currentGameId];localStorage.setObj("games",e);if(State.showingPlay){window.location.reload();return}history.back()}function share(e){const t=localStorage.getObj("games");const a=t[e];let n="https://awkword.co";if(!isDaily(e)){n+=`/?${e}`}let o;let s;if(a.made){o=`${a.hint}!`;s="myawkword"}else{const r=a.chosenIndices.map(e=>{return a.words[e]}).sort().join(", ");o=`${a.hint}! ${r}?`;s="awkword"}if(!navigator.canShare){o+=" \n\n"+n;const i=`https://twitter.com/intent/tweet?text=${encodeURIComponent(o)}&hashtags=${s}`;window.open(i,"_blank")}else{navigator.share({url:n,text:o,title:o})}}function getStats(e){let t=0;let a=0;let n=0;e.forEach(e=>{if(e.made){n++}else{if(e.won){t++}a++}});return{won:t,played:a,made:n}}function showHistoryAndUpdateUrl(){if(State.showingPlay){showHistory();updateUrlHash("?","history");State.showingPlay=false}else{history.back()}}function showHistory(){set("more","◂");set("daily-number","");set("history-container","");const o=$("history-container");const e=Object.values(localStorage.getObj("games"));const{won:t,played:a,made:n}=getStats(e);set("stats",`<b>${t}</b> won, <b>${a}</b> played, <b>${n}</b> made`);const s=document.createElement("br");o.appendChild(s);e.sort((e,t)=>t.timestamp-e.timestamp).forEach(t=>{const e=t.answerIndices.map(e=>t.words[e]);let a="";if(t.dailyNumber){a=`#${t.dailyNumber}`}if(t.won){a+=", won"}else if(t.made){a+="made"}const n=document.createElement("div");n.innerHTML=`<div class="history-title">
<span class="history-hint">${t.hint},${t.answerIndices.length}</span><i style="font-size: small;">${a}</i>
</div>
<div>${e.join(", ")}</div>
`;n.addEventListener("click",()=>{viewGameAndUpdateUrl(t)});o.appendChild(n).className="history-item"});showScreen("history")}function viewCellId(e){return`view${e}`}function viewGameAndUpdateUrl(e){updateUrlHash("?"+e.id,"view",{game:e});viewGame(e)}function viewGame(e){State.currentGameId=e.id;if(e.dailyNumber){set("daily-number","#"+e.dailyNumber)}set("timestamp",getGameTimestamp(e));hydrateGame("view-hint",e,viewCellId);showScreen("view");if(isHardMode()&&!e.made){hide("forget")}else{show("forget")}}function loadAlreadyPlayedGame(e){State.gameEnded=true;State.currentGame=e;State.currentGameId=e.id;set("more","☰");if(isDaily(State.currentGameId)){set("daily-number","#"+getDailyGameNumber())}set("timestamp",getGameTimestamp(e));hydrateGame("play-hint",e,e=>e);showNextGame();hide("play-submit");show("play-share");showScreen("play");show("status");if(isHardMode()&&!e.made){hide("forget")}else{show("forget")}}function getGameTimestamp(e){if(!e.timestamp){return""}const t=timeAgo(e.timestamp);let a="";if(e.won){a+="won"}else if(e.made){a+="made"}else{a+="played"}a+=` <b>${t}</b>`;return a}function hydrateGame(e,o,s){const{hint:t,words:r,answerIndices:i}=o;const l=o.chosenIndices||[];set(e,`${t},${i.length}`);range(WORDS_PER_GAME).forEach(e=>{const t=$(s(e));shade(t,Colors.NOT_CHOSEN);t.innerText=r[e];const a=l.includes(e);const n=i.includes(e);if((a||o.made)&&n){shadeWithBorder(t,Colors.CORRECT)}else if(n){if(!isHardMode()){shade(t,Colors.CORRECT)}}else if(a){shadeWithBorder(t,Colors.CHOSEN)}})}function makeCellId(e){return`make${e}`}async function showMakeGameAndUpdateUrl(){await showMakeGame();updateUrlHash("?","make")}async function showMakeGame(){if(!localStorage.get("makeModalShown")){localStorage.setObj("makeModalShown",true);showModal("make-modal")}$("misc").onclick=()=>showModal("make-modal");$("make-hint-input").value="";const a=State.currentMakeGame=await generateRandomGame();set("make-hint-count",`,${a.answerIndices.length}`);range(WORDS_PER_GAME).forEach(e=>{const t=$(makeCellId(e));shade(t,Colors.NOT_CHOSEN);t.innerText=a.words[e];if(a.answerIndices.includes(e)){shadeWithBorder(t,Colors.CORRECT)}});showScreen("make");hide("make-share")}function makeAndShare(){State.currentMakeGame.hint=$("make-hint-input").value;const e=serializeGameV1(State.currentMakeGame);State.currentMakeGame.id=e;State.currentMakeGame.made=true;delete State.currentMakeGame.wordListIndices;saveGame(State.currentMakeGame);share(e);history.back()}function deserializeGame(e){const t=rot13(e);const a=Base64.toNumber(t.substring(0,1));if(a===0){return deserializeGameV0(e,t)}else if(a===1){return deserializeGameV1(e,t)}}async function deserializeGameV0(e,t){const a=Base64.toNumber(t.substring(1,3));const n=range(WORDS_PER_GAME).map(e=>Base64.toNumber(t.substring(3+e*2,5+e*2)));const o=Base64.toNumber(t.substring(33,34));const s=range(o).map(e=>Base64.toNumber(t.substring(34+e,35+e)));const r=t.substring(34+o);return{id:e,hint:r,words:await getWords(a,n),answerIndices:s}}async function deserializeGameV1(e,t){const a=t.substring(1,7);const{words:n,answerIndices:o}=await generateRandomGame(a);const s=t.substring(7);return{id:e,hint:s,words:n,answerIndices:o}}async function getWordListSize(e){const t=await getWordList(e);return t.length}function getWords(e,a){return getWordList(e).then(t=>{return a.map(e=>t[e])})}function getWordList(e){const t="wordlist"+e;if(localStorage.get(t)){return Promise.resolve(localStorage.getObj(t))}else{return loadScript(`words/${t}.js`).then(()=>{return localStorage.getObj(t)})}}function getDailyGameNumber(){const e=new Date("08/20/2022").getTime();const t=(new Date).getTime();return Math.floor((t-e)/(1e3*3600*24))}function getDailyGameId(){const t="daily";return loadScript(`words/${t}.js`).then(()=>{const e=localStorage.getObj(t);return e[getDailyGameNumber()]})}function clearHistory(){localStorage.clear();localStorage.setObj("playModalShown",true);localStorage.setObj("makeModalShown",true);window.location.reload()}function toggleDarkMode(){$("modal").style.display="none"}function showScreen(e){const t=["play","history","view","make"];t.forEach(e=>{const t=document.querySelectorAll(`.${e}-screen`);Array.from(t).forEach(e=>{e.classList.add("hidden")})});const a=document.querySelectorAll(`.${e}-screen`);Array.from(a).forEach(e=>{e.classList.remove("hidden")})}window.addEventListener("load",async function(){createBoard("play-board",WORDS_PER_COL,WORDS_PER_ROW);createBoard("view-board",WORDS_PER_COL,WORDS_PER_ROW,viewCellId,()=>null);createBoard("make-board",WORDS_PER_COL,WORDS_PER_ROW,makeCellId,()=>null);const e=$("make-hint-input");e.addEventListener("input",t);t.call(e);function t(){let e=4;if(this.value.length>4){e=this.value.length}this.style.width=Math.max(e,10)+"ch"}$("make-hint-input").addEventListener("input",()=>{const e=$("make-hint-input").value.trim();if(e!==""){show("make-share")}else{hide("make-share")}});if(isHardMode()){$("hardmode").style.fontWeight="bold"}await initializePlayAndUpdateUrl()});function initializePlayAndUpdateUrl(){return initializePlay().then(e=>{if(isDaily(e)){history.replaceState({page:"play"},"","")}else{history.replaceState({page:"play"},"","?"+e)}})}async function initializePlay(){if(!localStorage.get("playModalShown")){localStorage.setObj("playModalShown",true);showModal("play-modal")}$("misc").onclick=()=>showModal("play-modal");State.showingPlay=true;let e=State.dailyGameId=await getDailyGameId();const t=new URLSearchParams(window.location.search);const a=Array.from(t.keys());if(a.length>0){e=a[0]}const n=localStorage.getObj("games");if(n[e]){await loadAlreadyPlayedGame(n[e])}else{await deserializeGame(e).then(e=>loadNewGame(e))}return e}function isDaily(e){return State.dailyGameId===e}function isHardMode(){return localStorage.get("hardmode")||false}function toggleHardMode(){localStorage.setObj("hardmode",!isHardMode());window.location.reload()}window.addEventListener("popstate",async e=>{if(!e.state||e.state.page==="play"){initializePlay()}else if(e.state.page==="history"){showHistory();State.showingPlay=false}else if(e.state.page==="view"){viewGame(e.state.game)}else if(e.state.page==="make"){await showMakeGame()}});!function(i,l,c){var d,m=256,u="random",h=c.pow(m,6),f=c.pow(2,52),g=2*f,w=m-1;function e(e,t,a){function n(){for(var e=r.g(6),t=h,a=0;e<f;)e=(e+a)*m,t*=m,a=r.g(1);for(;g<=e;)e/=2,t/=2,a>>>=1;return(e+a)/t}var o=[],s=p(function e(t,a){var n,o=[],s=typeof t;if(a&&"object"==s)for(n in t)try{o.push(e(t[n],a-1))}catch(e){}return o.length?o:"string"==s?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,b(l)]:null==e?function(){try{var e;return d&&(e=d.randomBytes)?e=e(m):(e=new Uint8Array(m),(i.crypto||i.msCrypto).getRandomValues(e)),b(e)}catch(e){var t=i.navigator,a=t&&t.plugins;return[+new Date,i,a,i.screen,b(l)]}}():e,3),o),r=new S(o);return n.int32=function(){return 0|r.g(4)},n.quick=function(){return r.g(4)/4294967296},n.double=n,p(b(r.S),l),(t.pass||a||function(e,t,a,n){return n&&(n.S&&y(n,r),e.state=function(){return y(r,{})}),a?(c[u]=e,t):e})(n,s,"global"in t?t.global:this==c,t.state)}function S(e){var t,a=e.length,r=this,n=0,o=r.i=r.j=0,s=r.S=[];for(a||(e=[a++]);n<m;)s[n]=n++;for(n=0;n<m;n++)s[n]=s[o=w&o+e[n%a]+(t=s[n])],s[o]=t;(r.g=function(e){for(var t,a=0,n=r.i,o=r.j,s=r.S;e--;)t=s[n=w&n+1],a=a*m+s[w&(s[n]=s[o=w&o+t])+(s[o]=t)];return r.i=n,r.j=o,a})(m)}function y(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var a,n=e+"",o=0;o<n.length;)t[w&o]=w&(a^=19*t[w&o])+n.charCodeAt(o++);return b(t)}function b(e){return String.fromCharCode.apply(0,e)}if(p(c.random(),l),"object"==typeof module&&module.exports){module.exports=e;try{d=require("crypto")}catch(e){}}else"function"==typeof define&&define.amd?define(function(){return e}):c["seed"+u]=e}("undefined"!=typeof self?self:this,[],Math);function $(e){return document.getElementById(e)}Storage.prototype.setObj=function(e,t){return this.setItem(e,JSON.stringify(t))};Storage.prototype.get=function(e){return JSON.parse(this.getItem(e))};Storage.prototype.getObj=function(e){return JSON.parse(this.getItem(e))||{}};function shade(e,t){e.style.backgroundColor=t;e.style.boxShadow=""}function shadeWithBorder(e,t){shade(e,t);e.style.boxShadow="0 0 0 3px "+adjust(t,-20)}function adjust(e,t){return"#"+e.replace(/^#/,"").replace(/../g,e=>("0"+Math.min(255,Math.max(0,parseInt(e,16)+t)).toString(16)).substr(-2))}function set(e,t){$(e).innerHTML=t}function show(e){$(e).classList.remove("hidden")}function hide(e){$(e).classList.add("hidden")}function showModal(e){let t=$("modal");$("modal-target").innerHTML=$(e).innerHTML;t.style.display="block";$("modal-close").onclick=function(){t.style.display="none"};window.onclick=window.ontouchend=function(e){if(e.target===t){t.style.display="none"}}}function range(e){return Array(e).fill(0).map((e,t)=>t)}function getRandomInt(e,t,a){a=a||Math.random;e=Math.ceil(e);t=Math.floor(t);return Math.floor(a()*(t-e)+e)}function loadScript(o){return new Promise(function(e,t){const a=document.getElementsByTagName("head")[0];const n=document.createElement("script");n.type="text/javascript";n.addEventListener("load",function(){this.removeEventListener("load",arguments.callee);e(n)});n.src=o;a.appendChild(n)})}const Colors={CHOSEN:"#E8E8E8",NOT_CHOSEN:"#FAF9F6",CORRECT:"#CCFFEF"};Base64={_Rixits:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!-",fromNumber:function(e,t){if(isNaN(Number(e))||e===null||e===Number.POSITIVE_INFINITY)throw"The input is not valid";if(e<0)throw"Can't represent negative numbers now";let a=t||0;let n;let o=Math.floor(e);let s="";while(true){n=o%64;s=this._Rixits.charAt(n)+s;o=Math.floor(o/64);if(o===0)break}return s.padStart(t||0,"0")},toNumber:function(t){let a=0;t=t.split("");for(let e=0;e<t.length;e++){a=a*64+this._Rixits.indexOf(t[e])}return a}};function generateRandomBase64String(t){let a="";for(let e=0;e<t;e++){a+=Base64.fromNumber(getRandomInt(0,64))}return a}function generateUniqueRandomNumbers(t,a,n){const o=[];for(let e=0;e<t;e++){let e=getRandomInt(0,a,n);while(o.includes(e)){e=getRandomInt(0,a,n)}o.push(e)}return o}function timeAgo(e){const t=e instanceof Date?e:new Date(e);const a=new Intl.RelativeTimeFormat("en");const n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1};const o=(t.getTime()-Date.now())/1e3;for(let e in n){if(n[e]<Math.abs(o)){const s=o/n[e];return a.format(Math.round(s),e)}}}function sleep(t){return new Promise(e=>setTimeout(e,t))}async function repeat(t,a){for(let e=0;e<t;e++){await a()}}function rot13(e){return e.replace(/[A-Z0-9]/gi,e=>"NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm9876543210"["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".indexOf(e)])}function timer(r,i,l,c){const e=function(){let e=tomorrow().getTime();let t=(new Date).getTime();let a=e-t;let n=Math.floor(a%(1e3*60*60*24)/(1e3*60*60));let o=Math.floor(a%(1e3*60*60)/(1e3*60));let s=Math.floor(a%(1e3*60)/1e3);$(r).innerHTML=i+" <b>"+n.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0")+":"+s.toString().padStart(2,"0")+"</b>";if(a<0){clearInterval(d);$(r).innerHTML=l;c()}};let d=setInterval(e,1e3);e()}function goTo(e){window.location.href=e}function tomorrow(){const e=new Date;const t=new Date(e);t.setDate(t.getDate()+1);t.setHours(0,0,0,0);return t}function updateUrlHash(e,t,a){history.pushState({page:t,...a},"",e)}
